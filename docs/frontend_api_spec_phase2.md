# í”„ë¡ íŠ¸ì—”ë“œ API ëª…ì„¸: ì±—ë´‡ Phase 2

## ê°œìš”

Phase 2ì—ì„œ ì¶”ê°€ëœ **í¬ë ˆë”§ ì‹œìŠ¤í…œ**ê³¼ **ì±„íŒ… ì„¸ì…˜** API ëª…ì„¸ì…ë‹ˆë‹¤.

---

## 1. ë°ì´í„° í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì±„íŒ… í”Œë¡œìš°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ì„¸ì…˜ ìƒì„± (ì„ íƒ)                                            â”‚
â”‚     POST /chatbot/sessions â†’ session_id íšë“                   â”‚
â”‚                                                                 â”‚
â”‚  2. ì±„íŒ… ìš”ì²­                                                   â”‚
â”‚     POST /chatbot/chat { query, session_id? }                  â”‚
â”‚                                                                 â”‚
â”‚  3. ì‘ë‹µ ì²˜ë¦¬                                                   â”‚
â”‚     - ì„±ê³µ: answer, consumed_credits, remaining_credits ìˆ˜ì‹    â”‚
â”‚     - ì‹¤íŒ¨: error ì½”ë“œì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬                         â”‚
â”‚                                                                 â”‚
â”‚  4. ì´ì „ ëŒ€í™” ì¡°íšŒ (ì„ íƒ)                                        â”‚
â”‚     GET /chatbot/sessions/:id â†’ messages ë°°ì—´                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. API ëª…ì„¸

### 2.1 ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ

**`GET /api/v1/users/profile`**

| í•„ë“œ      | íƒ€ì…     | ì„¤ëª…                      |
| --------- | -------- | ------------------------- |
| `credits` | `number` | í˜„ì¬ ì”ì—¬ í¬ë ˆë”§ (0 ì´ìƒ) |

```json
{
  "user_code": "google:xxx",
  "name": "í™ê¸¸ë™",
  "email": "user@example.com",
  "profile_image": "https://...",
  "role": "user",
  "created_at": "2025-01-01T12:00:00Z",
  "updated_at": "2025-01-01T12:00:00Z",
  "credits": 9
}
```

---

### 2.2 ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ

**`GET /api/v1/chatbot/sessions`**

**Query Parameters:**

| íŒŒë¼ë¯¸í„°    | íƒ€ì…     | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª…             |
| ----------- | -------- | ---- | ------ | ---------------- |
| `page`      | `number` | âŒ   | 1      | í˜ì´ì§€ ë²ˆí˜¸      |
| `page_size` | `number` | âŒ   | 20     | í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ |

**Response:**

> ğŸ“Œ **ì°¸ê³ **: ëª©ë¡ ì¡°íšŒ ì‹œ `messages`ëŠ” í•­ìƒ ë¹ˆ ë°°ì—´ì…ë‹ˆë‹¤. ì „ì²´ ëŒ€í™” ë‚´ìš©ì€ ì„¸ì…˜ ìƒì„¸ ì¡°íšŒ APIë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

```json
{
  "total": 5,
  "page": 1,
  "page_size": 20,
  "items": [
    {
      "id": "abc123",
      "title": "React ì„±ëŠ¥ ìµœì í™” ì§ˆë¬¸...",
      "messages": [],
      "created_at": "2025-12-22T10:00:00Z",
      "updated_at": "2025-12-22T10:30:00Z"
    }
  ]
}
```

---

### 2.3 ì„¸ì…˜ ìƒì„±

**`POST /api/v1/chatbot/sessions`**

**Request Body:** ì—†ìŒ

**Response:**

```json
{
  "id": "abc123",
  "title": "New Chat",
  "messages": [],
  "created_at": "2025-12-22T10:00:00Z",
  "updated_at": "2025-12-22T10:00:00Z"
}
```

---

### 2.4 ì„¸ì…˜ ìƒì„¸ ì¡°íšŒ

**`GET /api/v1/chatbot/sessions/:id`**

**Path Parameters:**

| íŒŒë¼ë¯¸í„° | íƒ€ì…     | ì„¤ëª…    |
| -------- | -------- | ------- |
| `id`     | `string` | ì„¸ì…˜ ID |

**Response:**

```json
{
  "id": "abc123",
  "title": "React ì„±ëŠ¥ ìµœì í™” ì§ˆë¬¸...",
  "messages": [
    {
      "role": "user",
      "content": "React ì„±ëŠ¥ ìµœì í™” ë°©ë²•ì€?",
      "created_at": "..."
    },
    { "role": "assistant", "content": "React ì„±ëŠ¥ì„...", "created_at": "..." }
  ],
  "created_at": "...",
  "updated_at": "..."
}
```

---

### 2.5 ì„¸ì…˜ ì‚­ì œ

**`DELETE /api/v1/chatbot/sessions/:id`**

**Path Parameters:**

| íŒŒë¼ë¯¸í„° | íƒ€ì…     | ì„¤ëª…    |
| -------- | -------- | ------- |
| `id`     | `string` | ì„¸ì…˜ ID |

**Response:** `200 OK` (body ì—†ìŒ)

---

### 2.6 ì±„íŒ… ìš”ì²­

**`POST /api/v1/chatbot/chat`**

**Request Body:**

| í•„ë“œ         | íƒ€ì…     | í•„ìˆ˜ | ì„¤ëª…                                    |
| ------------ | -------- | ---- | --------------------------------------- |
| `query`      | `string` | âœ…   | ì‚¬ìš©ì ì§ˆë¬¸                             |
| `session_id` | `string` | âŒ   | ì„¸ì…˜ ID (ì œê³µ ì‹œ í•´ë‹¹ ì„¸ì…˜ì— ëŒ€í™” ì €ì¥) |

```json
{
  "query": "React ì„±ëŠ¥ ìµœì í™” ë°©ë²•ì€?",
  "session_id": "abc123"
}
```

**Response (ì„±ê³µ):**

| í•„ë“œ                | íƒ€ì…     | ì„¤ëª…                        |
| ------------------- | -------- | --------------------------- |
| `answer`            | `string` | AI ì‘ë‹µ                     |
| `consumed_credits`  | `number` | ì´ë²ˆ ìš”ì²­ì—ì„œ ì†Œëª¨ëœ í¬ë ˆë”§ |
| `remaining_credits` | `number` | ìš”ì²­ í›„ ë‚¨ì€ í¬ë ˆë”§         |

```json
{
  "answer": "React ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´...",
  "consumed_credits": 1,
  "remaining_credits": 8
}
```

---

## 3. ì—ëŸ¬ ì²˜ë¦¬

| HTTP | error                  | ì„¤ëª…                     | ê¶Œì¥ ì²˜ë¦¬              |
| ---- | ---------------------- | ------------------------ | ---------------------- |
| 400  | `invalid_request`      | ìš”ì²­ í˜•ì‹ ì˜¤ë¥˜           | ì…ë ¥ê°’ ê²€ì¦            |
| 400  | `invalid_session_id`   | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” session_id | ìƒˆ ì„¸ì…˜ ìƒì„± í›„ ì¬ì‹œë„ |
| 402  | `insufficient_credits` | í¬ë ˆë”§ ë¶€ì¡±              | ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´        |
| 503  | `chatbot_unavailable`  | ì±—ë´‡ ì„œë¹„ìŠ¤ ì¥ì•          | ì¬ì‹œë„ ì•ˆë‚´            |

**ì—ëŸ¬ ì‘ë‹µ í˜•ì‹:**

```json
{
  "error": "insufficient_credits"
}
```
